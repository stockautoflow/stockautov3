ã¯ã„ã€æ‰¿çŸ¥ã„ãŸã—ã¾ã—ãŸã€‚  
ã“ã‚Œã¾ã§ã®è­°è«–ã§ç¢ºå®šã—ãŸæœ€çµ‚ä»•æ§˜ã«åŸºã¥ãã€ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã®è¨­è¨ˆæ›¸ã‚’Markdownå½¢å¼ã§ä½œæˆã—ã¾ã™ã€‚

---

# **DynamicStrategy ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°è¨­è¨ˆæ›¸**

## **1\. æ¦‚è¦**

### **1.1. èƒŒæ™¯ã¨ç›®çš„**

ç¾è¡Œã®src/core/strategy.pyã«å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹DynamicStrategyã‚¯ãƒ©ã‚¹ã¯ã€åˆæœŸåŒ–ã€å–å¼•åˆ¤æ–­ã€æ³¨æ–‡ã€çŠ¶æ…‹ç®¡ç†ãªã©å¤šæ•°ã®è²¬å‹™ã‚’æ‹…ã£ã¦ãŠã‚Šã€ã‚³ãƒ¼ãƒ‰ã®è¤‡é›‘æ€§ãŒå¢—å¤§ã—ã¦ã„ã‚‹ã€‚

æœ¬è¨­è¨ˆã¯ã€**å˜ä¸€è²¬ä»»ã®åŸå‰‡**ã«åŸºã¥ãã‚¯ãƒ©ã‚¹ã‚’åˆ†å‰²ã—ã€å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ç‹¬ç«‹æ€§ã‚’é«˜ã‚ã‚‹ã“ã¨ã§ã€**ä¿å®ˆæ€§ãƒ»å¯èª­æ€§ãƒ»ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§**ã‚’å‘ä¸Šã•ã›ã‚‹ã“ã¨ã‚’ç›®çš„ã¨ã™ã‚‹ã€‚

### **1.2. è¨­è¨ˆæ–¹é‡**

* **ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ã¨å°‚é–€å®¶ãƒ¢ãƒ‡ãƒ«**: DynamicStrategyã‚’å„å°‚é–€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’**çµ±æ‹¬ãƒ»æŒ‡æ®ã™ã‚‹**ã€Œã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ã€ã¨ä½ç½®ã¥ã‘ã€å…·ä½“çš„ãªå‡¦ç†ã¯å°‚é–€å®¶ã‚¯ãƒ©ã‚¹ã«å§”è­²ã™ã‚‹ã€‚  
* **ã‚³ãƒ³ãƒã‚¸ã‚·ãƒ§ãƒ³ï¼ˆåˆæˆï¼‰**: ç¶™æ‰¿ã§ã¯ãªãã€ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ãŒå°‚é–€å®¶ã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä¿æŒï¼ˆåˆæˆï¼‰ã™ã‚‹æ§‹æˆã‚’æ¡ç”¨ã™ã‚‹ã€‚

---

## **2\. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**

### **2.1. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹æˆ**

src/core/strategy/ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã«ã€ä»¥ä¸‹ã®9ã¤ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆã‚¯ãƒ©ã‚¹ï¼‰ã‚’é…ç½®ã™ã‚‹ã€‚

| ãƒ•ã‚¡ã‚¤ãƒ«å | ã‚¯ãƒ©ã‚¹å | å½¹å‰² |
| :---- | :---- | :---- |
| strategy\_orchestrator.py | DynamicStrategy | ğŸ¼ **å¸ä»¤å¡” (ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼)** |
| strategy\_initializer.py | StrategyInitializer | âš™ï¸ **åˆæœŸåŒ–ã¨è¨­å®š** |
| entry\_signal\_generator.py | EntrySignalGenerator | ğŸ§  **ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‚·ã‚°ãƒŠãƒ«ç”Ÿæˆ** |
| exit\_signal\_generator.py | ExitSignalGenerator | ğŸ” **ã‚¨ã‚°ã‚¸ãƒƒãƒˆã‚·ã‚°ãƒŠãƒ«ç”Ÿæˆ** |
| order\_manager.py | OrderManager | ğŸš€ **æ³¨æ–‡ã®ç™ºæ³¨** |
| position\_manager.py | PositionManager | ğŸ’¾ **ãƒã‚¸ã‚·ãƒ§ãƒ³ã®çŠ¶æ…‹ç®¡ç†ã¨å¾©å…ƒ** |
| event\_handler.py | EventHandler | ğŸ“‹ **ã‚¤ãƒ™ãƒ³ãƒˆã®è§£é‡ˆãƒ»æƒ…å ±æ•´å½¢** |
| strategy\_logger.py | StrategyLogger | âœï¸ **æƒ…å ±ã®ãƒ­ã‚°è¨˜éŒ²** |
| strategy\_notifier.py | StrategyNotifier | ğŸ“§ **æƒ…å ±ã®ãƒ¡ãƒ¼ãƒ«é€šçŸ¥** |

### **2.2. é€£æºã‚·ãƒ¼ã‚±ãƒ³ã‚¹**

ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“ã®ä¸»è¦ãªé€£æºãƒ•ãƒ­ãƒ¼ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã‚ã‚‹ã€‚

#### **ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‚·ãƒ¼ã‚±ãƒ³ã‚¹**

\!([https://i.imgur.com/example.png](https://www.google.com/search?q=https://i.imgur.com/example.png&authuser=5))

1. **DynamicStrategy**: next()ã§ãƒã‚¸ã‚·ãƒ§ãƒ³ãŒãªã„ã“ã¨ã‚’ç¢ºèªã€‚  
2. â†’ **EntrySignalGenerator**: check\_entry\_signal()ã‚’å‘¼ã³å‡ºã—ã€ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‚·ã‚°ãƒŠãƒ«ã‚’è¦æ±‚ã€‚  
3. â† **EntrySignalGenerator**: ã‚·ã‚°ãƒŠãƒ«ï¼ˆä¾‹: 'long'ï¼‰ã¨ã‚¨ãƒ³ãƒˆãƒªãƒ¼æ ¹æ‹ ã‚’è¿”ã™ã€‚  
4. â†’ **OrderManager**: place\_entry\_order()ã‚’å‘¼ã³å‡ºã—ã€ã‚·ã‚°ãƒŠãƒ«ã«åŸºã¥ãæ³¨æ–‡ã‚’ç™ºæ³¨ã€‚  
5. â†’ **EventHandler**: æ³¨æ–‡ç™ºæ³¨ã‚¤ãƒ™ãƒ³ãƒˆã‚’on\_entry\_order\_placed()ã§å—ã‘å–ã‚‹ã€‚  
6. â†’ **StrategyLogger / StrategyNotifier**: æ•´å½¢ã•ã‚ŒãŸæƒ…å ±ã‚’ãƒ­ã‚°è¨˜éŒ²ãƒ»é€šçŸ¥ã™ã‚‹ã€‚

#### **ã‚¤ãƒ™ãƒ³ãƒˆé€šçŸ¥ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ (æ³¨æ–‡ç´„å®šæ™‚)**

1. **backtrader**: æ³¨æ–‡çŠ¶æ…‹ã®æ›´æ–°ã‚’DynamicStrategy.notify\_order()ã«é€šçŸ¥ã€‚  
2. â†’ **DynamicStrategy**: orderã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’EventHandler.on\_order\_update()ã«æ¸¡ã™ã€‚  
3. â†’ **EventHandler**: orderã®çŠ¶æ…‹ï¼ˆç´„å®šã€ã‚¨ãƒ©ãƒ¼ç­‰ï¼‰ã‚’è§£é‡ˆã—ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ•´å½¢ã€‚  
4. â†’ **StrategyLogger / StrategyNotifier**: æ•´å½¢ã•ã‚ŒãŸæƒ…å ±ã‚’ãƒ­ã‚°è¨˜éŒ²ãƒ»é€šçŸ¥ã™ã‚‹ã€‚

---

## **3\. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè©³ç´°è¨­è¨ˆ**

### **3.1. strategy\_orchestrator.py (å¸ä»¤å¡”)**

* **ã‚¯ãƒ©ã‚¹å**: DynamicStrategy  
* **è²¬å‹™**: backtraderã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ï¼ˆ\_\_init\_\_, next, notify\_orderç­‰ï¼‰ã‚’ãƒ•ãƒƒã‚¯ã—ã€å„å°‚é–€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«å‡¦ç†ã‚’é©åˆ‡ã«å§”è­²ã™ã‚‹ã€‚  
* **ä¸»è¦ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹**:  
  * \_\_init\_\_(self): å…¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã—ã€ä¾å­˜é–¢ä¿‚ã‚’æ³¨å…¥ã™ã‚‹ã€‚  
  * next(self): ãƒ‡ãƒ¼ã‚¿æ›´æ–°æ™‚ã«ã€ãƒã‚¸ã‚·ãƒ§ãƒ³ã®æœ‰ç„¡ã«å¿œã˜ã¦EntrySignalGeneratorã¾ãŸã¯ExitSignalGeneratorã‚’å‘¼ã³å‡ºã™ã€‚  
  * notify\_order(self, order): æ³¨æ–‡ã‚¤ãƒ™ãƒ³ãƒˆã‚’EventHandlerã«å§”è­²ã™ã‚‹ã€‚  
  * notify\_trade(self, trade): ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆã‚’PositionManagerã«å§”è­²ã™ã‚‹ã€‚

### **3.2. strategy\_initializer.py (åˆæœŸåŒ–)**

* **ã‚¯ãƒ©ã‚¹å**: StrategyInitializer  
* **è²¬å‹™**: æˆ¦ç•¥ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«åŸºã¥ãã€å–å¼•ã«å¿…è¦ãªã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ç¾¤ã‚’ç”Ÿæˆã™ã‚‹ã€‚  
* **ä¸»è¦ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹**:  
  * \_\_init\_\_(self, strategy\_params)  
  * create\_indicators(self, data\_feeds) \-\> dict: backtraderã®ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®è¾æ›¸ã‚’è¿”ã™ã€‚

### **3.3. entry\_signal\_generator.py (ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‚·ã‚°ãƒŠãƒ«)**

* **ã‚¯ãƒ©ã‚¹å**: EntrySignalGenerator  
* **è²¬å‹™**: ç¾åœ¨ã®å¸‚å ´ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã€ã‚¨ãƒ³ãƒˆãƒªãƒ¼æ¡ä»¶ã‚’æº€ãŸã—ã¦ã„ã‚‹ã‹ã‚’åˆ¤æ–­ã™ã‚‹ã€‚  
* **ä¸»è¦ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹**:  
  * \_\_init\_\_(self, indicators, data\_feeds)  
  * check\_entry\_signal(self, strategy\_params) \-\> (str | None, str | None): ã‚·ã‚°ãƒŠãƒ«ï¼ˆ'long', 'short'ï¼‰ã¨ã‚¨ãƒ³ãƒˆãƒªãƒ¼æ ¹æ‹ ï¼ˆæ–‡å­—åˆ—ï¼‰ã®ã‚¿ãƒ—ãƒ«ã€ã¾ãŸã¯(None, None)ã‚’è¿”ã™ã€‚

### **3.4. exit\_signal\_generator.py (ã‚¨ã‚°ã‚¸ãƒƒãƒˆã‚·ã‚°ãƒŠãƒ«)**

* **ã‚¯ãƒ©ã‚¹å**: ExitSignalGenerator  
* **è²¬å‹™**: ä¿æœ‰ãƒã‚¸ã‚·ãƒ§ãƒ³ã®æ±ºæ¸ˆæ¡ä»¶ï¼ˆåˆ©ç¢ºã€æåˆ‡ã‚Šï¼‰ã‚’ç›£è¦–ãƒ»åˆ¤æ–­ã™ã‚‹ã€‚  
* **ä¸»è¦ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹**:  
  * \_\_init\_\_(self, strategy, indicators, order\_manager)  
  * calculate\_and\_set\_exit\_prices(self, entry\_price, is\_long): æ±ºæ¸ˆä¾¡æ ¼ã‚’è¨ˆç®—ã—ã€å†…éƒ¨çŠ¶æ…‹ã¨ã—ã¦ä¿æŒã™ã‚‹ã€‚  
  * check\_exit\_conditions(self): æ±ºæ¸ˆæ¡ä»¶ã‚’è©•ä¾¡ã—ã€æ¡ä»¶ã‚’æº€ãŸã›ã°OrderManagerã«æ±ºæ¸ˆã‚’ä¾é ¼ã™ã‚‹ã€‚

### **3.5. order\_manager.py (æ³¨æ–‡ç™ºæ³¨)**

* **ã‚¯ãƒ©ã‚¹å**: OrderManager  
* **è²¬å‹™**: æ³¨æ–‡ã‚µã‚¤ã‚ºã‚’ç®—å‡ºã—ã€backtraderã®APIã‚’å‘¼ã³å‡ºã—ã¦å®Ÿéš›ã«æ³¨æ–‡ã‚’ç™ºæ³¨ã™ã‚‹ã€‚  
* **ä¸»è¦ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹**:  
  * \_\_init\_\_(self, strategy, sizing\_params, event\_handler)  
  * place\_entry\_order(self, trade\_type, reason, indicators): æ–°è¦æ³¨æ–‡ã‚’ç™ºæ³¨ã™ã‚‹ã€‚  
  * close\_position(self): ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚’æ±ºæ¸ˆã™ã‚‹æ³¨æ–‡ã‚’ç™ºæ³¨ã™ã‚‹ã€‚

### **3.6. position\_manager.py (çŠ¶æ…‹ç®¡ç†)**

* **ã‚¯ãƒ©ã‚¹å**: PositionManager  
* **è²¬å‹™**: ãƒã‚¸ã‚·ãƒ§ãƒ³ã®çŠ¶æ…‹ï¼ˆã‚µã‚¤ã‚ºã€ä¾¡æ ¼ç­‰ï¼‰ã‚’ä¿æŒã—ã€ã‚·ã‚¹ãƒ†ãƒ å†èµ·å‹•æ™‚ã«ãã®çŠ¶æ…‹ã‚’å¾©å…ƒã™ã‚‹ã€‚  
* **ä¸»è¦ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹**:  
  * \_\_init\_\_(self, persisted\_position)  
  * restore\_state(self, strategy, exit\_signal\_generator): strategyã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®çŠ¶æ…‹ã‚’å¾©å…ƒã™ã‚‹ã€‚  
  * on\_trade\_update(self, trade, strategy): ãƒˆãƒ¬ãƒ¼ãƒ‰é–‹å§‹ãƒ»çµ‚äº†æ™‚ã«ãƒã‚¸ã‚·ãƒ§ãƒ³æƒ…å ±ã‚’æ›´æ–°ã™ã‚‹ã€‚

### **3.7. event\_handler.py (ã‚¤ãƒ™ãƒ³ãƒˆè§£é‡ˆ)**

* **ã‚¯ãƒ©ã‚¹å**: EventHandler  
* **è²¬å‹™**: backtraderã‹ã‚‰ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’äººé–“ãŒèª­ã‚ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«è§£é‡ˆãƒ»æ•´å½¢ã™ã‚‹ã€‚  
* **ä¸»è¦ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹**:  
  * \_\_init\_\_(self, strategy, logger, notifier)  
  * on\_order\_update(self, order): æ³¨æ–‡ã‚¤ãƒ™ãƒ³ãƒˆã‚’è§£é‡ˆã—ã€StrategyLoggerã¨StrategyNotifierã«å‡¦ç†ã‚’ä¾é ¼ã™ã‚‹ã€‚

### **3.8. strategy\_logger.py (ãƒ­ã‚°è¨˜éŒ²)**

* **ã‚¯ãƒ©ã‚¹å**: StrategyLogger  
* **è²¬å‹™**: æ•´å½¢æ¸ˆã¿ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã«è¨˜éŒ²ã™ã‚‹ã€‚  
* **ä¸»è¦ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹**:  
  * \_\_init\_\_(self, strategy)  
  * log(self, txt, level): æŒ‡å®šã•ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒ­ã‚°ã«å‡ºåŠ›ã™ã‚‹ã€‚

### **3.9. strategy\_notifier.py (é€šçŸ¥)**

* **ã‚¯ãƒ©ã‚¹å**: StrategyNotifier  
* **è²¬å‹™**: æ•´å½¢æ¸ˆã¿ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒ¡ãƒ¼ãƒ«ç­‰ã®æ‰‹æ®µã§å¤–éƒ¨ã«é€šçŸ¥ã™ã‚‹ã€‚  
* **ä¸»è¦ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹**:  
  * \_\_init\_\_(self, live\_trading, strategy)  
  * send(self, subject, body, immediate): å¤–éƒ¨é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ã‚’ä¾é ¼ã™ã‚‹ã€‚