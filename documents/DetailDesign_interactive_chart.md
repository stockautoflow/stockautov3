# **インタラクティブ・チャート機能 詳細設計書 (v1.0)**

## **1\. 概要**

### **1.1. 機能の目的**

本機能は、従来の静的なPNG画像によるチャート出力機能を拡張し、利用者がWebブラウザ上で直感的に操作できるインタラクティブなHTMLチャートを生成することを目的とする。これにより、バックテスト結果の詳細な分析、特に取引が行われた箇所の拡大・縮小や、各指標の数値確認が容易になり、戦略改善のサイクルを高速化する。

### **1.2. アーキテクチャ**

* **描画ライブラリ**: matplotlibおよびmplfinanceから、インタラクティブなグラフ作成に優れたPlotlyライブラリに移行する。  
* **出力形式**: 従来の.pngファイルに代わり、単一で動作する.htmlファイルを銘柄・時間足ごとに生成する。  
* **実行フロー**: chart\_generator.pyの内部ロジックをPlotlyベースに置き換える。利用者の操作（python chart\_generator.pyの実行）は従来通り変更しない。

## **2\. インターフェース仕様**

### **2.1. 入力**

従来と変更なし。

* **取引履歴レポート**: backtest\_results/report/trade\_history\_\*.csv  
* **価格データ**: data/\*.csv  
* **戦略設定ファイル**: strategy.yml

### **2.2. 出力**

| ファイル名 | 保存先 | 説明 |
| :---- | :---- | :---- |
| chart\_interactive\_\[銘柄コード\]\_\[時間足\].html | backtest\_results/chart/ | Plotlyで生成されたインタラクティブなHTMLチャート。 |

*例: chart\_interactive\_1332\_short.html, chart\_interactive\_1332\_medium.html*

## **3\. 機能仕様**

### **3.1. 基本チャート機能**

| 機能 | 詳細 |
| :---- | :---- |
| **ローソク足表示** | 日本の慣習に合わせ、**陽線を赤、陰線を緑**で表示する。 |
| **ズーム** | マウスホイールのスクロール、またはチャート右上のツールバーの「＋」「ー」ボタンで、特定の期間を拡大・縮小できる。ダブルクリックで初期表示に戻る。 |
| **パン（移動）** | チャートをドラッグすることで、表示期間を前後左右に移動できる。 |
| **ホバー表示** | ローソク足にカーソルを合わせると、その足の**日時、四本値（OHLC）、出来高**がツールチップで表示される。インジケーターの線に合わせるとその値が表示される。 |

### **3.2. インジケーター・取引表示**

| 機能 | 詳細 |
| :---- | :---- |
| **移動平均線（EMA）** | 短期・長期チャートに表示。ホバーで期間と数値を表示。凡例クリックで表示/非表示を切り替え可能。 |
| **RSI** | 中期チャートの下部パネルに表示。**買われすぎ（デフォルト70）の閾値ラインを赤**、**売られすぎ（デフォルト30）の閾値ラインを緑**で表示する。 |
| **売買ポイント** | 取引があった箇所にマーカーを表示する。 ・BUYエントリー: 赤色の上向き三角 ・SELLエントリー: 緑色の下向き三角 ホバーすると、エントリー価格や日時などの詳細情報を表示。 |
| **損切り・利確ライン** | 各トレードに対応する損切り(SL)・利確(TP)ラインを点線で表示する。 ・利確ライン: 赤色の点線 ・損切りライン: 緑色の点線 |
| **凡例（凡例）のインタラクション** | チャートの凡例項目（例: EMA(10)）をクリックすることで、該当するインジケーターの表示/非表示を動的に切り替えることができる。 |

### **3.3. 画面レイアウト案**

* **タイトル**: \[銘柄コード\] \[時間足\] Interactive Chart  
* **ツールバー**: チャート右上にPlotly標準の操作ツールバーが表示される。  
* **メインパネル**: ローソク足、EMA、売買マーカー、SL/TPライン。  
* **出来高パネル**: メインパネルの下に出来高を棒グラフで表示。  
* **RSIパネル（中期チャートのみ）**: 出来高パネルの下にRSIをラインで表示。

## **4\. 技術要件**

* **新規追加ライブラリ**: plotly  
* requirements.txtにplotlyを追加する必要がある。

## **5\. 将来的な拡張案（発展）**

本仕様に慣れた後、さらなる機能強化として以下の拡張が考えられる。

* **Webアプリケーション化 (Flask / Dash)**:  
  * Webページ上で銘柄や時間足をドロップダウンで選択・切り替え。  
  * インジケーターのパラメータ（期間など）をWebフォームで変更し、チャートを動的に再描画。  
* **取引履歴テーブルとの連動**:  
  * チャートの下に表示した取引履歴テーブルの行をクリックすると、チャート上の対応する売買ポイントにズームアップ＆ハイライトする。