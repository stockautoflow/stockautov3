はい、承知いたしました。  
影響最小化版のアーキテクチャを反映した、リアルタイム自動トレード監視ダッシュボードの機能仕様書（Ver. 1.1）の全文を以下に掲載します。

---

## **リアルタイム自動トレード監視ダッシュボード 機能仕様書**

| ドキュメントバージョン | 1.1 (影響最小化版アーキテクチャ反映) |
| :---- | :---- |
| **作成日** | 2025年8月1日 |
| **作成者** | Gemini |
| **変更概要** | 既存実装への影響を最小化するため、取引エンジンとダッシュボードをプロセスレベルで分離。情報共有は共有データベース(SQLite)を介して行うアーキテクチャに変更。 |

### **1\. 概要**

#### **1.1. 本書の位置づけ**

本書は、開発中の株取引自動化プロジェクトにおける「リアルタイム監視ダッシュボード」の機能要件、アーキテクチャ、およびデータ仕様を定義するものです。

#### **1.2. 背景**

現在、本プロジェクトではバックテスト機能およびリアルタイムトレード機能の実装が完了しています。次のフェーズとして、稼働中のリアルタイムトレードシステムの状況をリアルタイムに可視化し、システムの健全性監視とパフォーマンス分析を可能にするための専用ダッシュボードを開発します。

#### **1.3. 目的**

本ダッシュボードは、以下の目的を達成します。

* システム全体の資産状況とパフォーマンスをリアルタイムで把握する。  
* 現在の保有ポジション（リスクエクスポージャー）を即座に確認する。  
* 各銘柄のライブチャート上で、戦略の動作（エントリー、SL/TPラインなど）を視覚的に検証する。  
* システムログや注文履歴を一元的に監視し、問題発生時に迅速な原因究明を支援する。

---

### **2\. システムアーキテクチャ (改訂)**

#### **2.1. 構成図**

取引エンジンとダッシュボードは、それぞれが独立して動作する**別々のプロセス**として構成されます。両者の連携は、共有のSQLiteデータベースを介して行われます。

コード スニペット

graph TD  
    subgraph "Process 1: 取引エンジン"  
        A\[python \-m src.realtrade.run\_realtrade\] \--\>|1. 状態を書き込み| B(SQLite DB)  
    end

    subgraph "Process 2: ダッシュボード"  
        C\[python \-m src.dashboard.run\_dashboard\] \--\>|2. 状態を読み込み| B  
        C \--\> D\[Web UI on Port 5003\]  
    end

    E\[ユーザーのブラウザ\] \-- HTTP \--\> D

#### **2.2. データフロー**

1. **状態の書き込み**: 取引エンジン・プロセス (run\_realtrade.py) は、取引の実行中に自身の最新状態（資産状況、ポジション、ログ等）を定期的に共有データベース (SQLite) へ書き込みます。  
2. **状態の読み込み**: 新設されるダッシュボード・プロセス (run\_dashboard.py) は、定期的に共有データベースをポーリングし、最新情報を取得します。  
3. **UIの構築と更新**: ダッシュボードは取得したデータを基にWeb UIを構築し、ユーザーのブラウザへ送信します。ブラウザ側はJavaScriptを用いて、サーバーに最新データを問い合わせ、画面を動的に更新します。

#### **2.3. 使用技術スタック**

* **バックエンド:** Python, Flask  
* **フロントエンド:** HTML, CSS, JavaScript  
* **チャート描画:** Plotly.js  
* **データ処理:** pandas

---

### **3\. 機能要件**

#### **3.1. 画面レイアウト**

単一のページ/liveで、以下の4つのコンポーネントを統合表示します。

\+----------------------------------------------------------------------+  
| 1\. サマリーパネル                                                    |  
\+------------------------------------------+---------------------------+  
| 2\. 保有ポジション一覧 (テーブル)         | 3\. 詳細ライブチャート     |  
|                                          |                           |  
|                                          |                           |  
|                                          |                           |  
\+------------------------------------------+---------------------------+  
| 4\. ログ・注文パネル (タブ切り替え)                                   |  
\+----------------------------------------------------------------------+

#### **3.2. コンポーネント詳細**

* **サマリーパネル**: システム全体の資産状況、損益、稼働状況を表示。  
* **保有ポジション一覧**: 現在保有中の全ポジションをテーブルでリアルタイム表示。  
* **詳細ライブチャート**: 選択した銘柄の価格、インジケーター、SL/TPラインをリアルタイム描画。  
* **ログ・注文パネル**: システムログと注文履歴をタブで表示。

---

### **4\. データ仕様**

#### **4.1. APIエンドポイント**

ダッシュボードのバックエンドは、以下のAPIを提供します。

* GET /api/live/status: サマリーとポジション一覧のデータを返却。  
* GET /api/live/chart\_data?symbol=\<symbol\>: 指定銘柄のチャートデータを返却。  
* GET /api/live/logs?since=\<timestamp\>: 指定時刻以降のログを返却。

---

### **5\. 運用**

本アーキテクチャの採用により、取引エンジンとダッシュボードは個別に起動する必要があります。

1. **取引エンジンの起動:**  
   Bash  
   python \-m src.realtrade.run\_realtrade

2. **ダッシュボードの起動:** (別のターミナルで)  
   Bash  
   python \-m src.dashboard.run\_dashboard

3. アクセス:  
   Webブラウザで http://localhost:5003/live にアクセスします。