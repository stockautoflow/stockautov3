# **統合仕様書 \- 株自動トレードシステム (v74.5)**

## **目次**

1. [**株自動トレードシステム 基本仕様書 (v74.5)**](#bookmark=id.nyuw0tgumuyf)  
   * [1.1. システムの目的](#bookmark=id.ddnwumjecl52)  
   * [1.2. 主な目標](#bookmark=id.3yp729ainndq)  
   * [1.3. システム要件](#bookmark=id.5a59sx77hrhg)  
   * [1.4. システム構成](#bookmark=id.9u5uj9aaw03c)  
   * [1.5. 運用フロー](#bookmark=id.t8h2n1obj6rd)  
   * [1.6. リスクと対策](#bookmark=id.mgnbpdx2c5mb)  
   * [1.7. 免責事項](#bookmark=id.8hu9ybg63j35)  
2. [**株自動トレードシステム 詳細設計書 (v74.5)**](#bookmark=id.4merfjjttcxk)  
   * [2.1. アーキテクチャ](#bookmark=id.svb262dfhwar)  
   * [2.2. 環境構築と使用方法](#bookmark=id.tq89tww46de)  
   * [2.3. モジュール別詳細仕様](#bookmark=id.40awkrc63vq1)  
3. [**チャート機能 詳細設計書 (v74.5)**](#bookmark=id.u8707q3q025z)  
   * [3.1. 機能の目的とアーキテクチャ](#bookmark=id.diwuqhk4rrak)  
   * [3.2. インターフェース仕様](#bookmark=id.j0okbrblcbne)  
   * [3.3. 機能仕様詳細](#bookmark=id.fj4vso479hx8)  
4. [**ATRトレーリングストップ 実装仕様書 (v74.5)**](#bookmark=id.fftrpokoikq6)  
   * [4.1. 目的と実装方針](#bookmark=id.vo5es2kecijw)  
   * [4.2. strategy.yml 仕様](#bookmark=id.3ofcn0wf370z)  
   * [4.3. btrader\_strategy.py 実装仕様](#bookmark=id.2z2z2vpa4m4o)  
5. [**トレード戦略のカスタマイズ方法 (v74.5)**](#bookmark=id.h218x7dy64h6)  
   * [5.1. データソースの定義 (timeframes)](#bookmark=id.pom9u6orn9fb)  
   * [5.2. エントリー条件の定義 (entry\_conditions)](#bookmark=id.cynh712y8aii)  
   * [5.3. イグジット条件の定義 (exit\_conditions)](#bookmark=id.r92pgmz98cv6)  
   * [5.4. ポジションサイジングの定義 (sizing)](#bookmark=id.z93h2vz7boe)  
6. [**エントリー戦略アイデア集**](#bookmark=id.o16w7zbzc16u)

## **1\. 株自動トレードシステム 基本仕様書 (v74.5)**

### **1.1. システムの目的**

本システムは、高機能なバックテストフレームワーク **Backtrader** と、インタラクティブなグラフ描画ライブラリ **Plotly** を利用し、取引戦略の有効性を効率的かつ詳細に検証することを目的とする。マルチタイムフレーム分析に基づいた戦略を、コストやリスクを考慮して評価し、その結果を**Webブラウザ上で対話的に分析**することで、戦略改善のサイクルを高速化する。

### **1.2. 主な目標**

* **完全な戦略定義の外部化**: Pythonコードを編集することなく、設定ファイル（strategy.yml）の記述を変更するだけで、**データソース、エントリー、イグジット（損切り/利確）、ポジションサイズ計算**の全てを組み合わせ、柔軟に定義・検証できる。  
* **柔軟なデータソース定義**: 短期・中期・長期の各時間足について、元となる短期足からの**リサンプリング**で生成するか、時間足ごとに用意された**個別ファイルを直接読み込む**かを選択可能にする。これにより、バックテストの精度と柔軟性を向上させる。  
* **現実的なシミュレーション**: 取引手数料やスリッページを考慮し、より実践に近い損益を算出する。バックテスト期間終了時に未決済のポジションも、最終終値で評価・計上される。  
* **高度な決済注文**: BacktraderのネイティブOCO（One-Cancels-Other）注文とトレーリングストップ（StopTrail）機能を活用し、信頼性の高い決済ロジックを実現する。  
* **高度な分析UI**:  
  * **Webアプリケーション**: FlaskをWebサーバーとし、ブラウザから http://127.0.0.1:5001 にアクセスすることで分析ツールを起動する。  
  * **動的チャート**: Webページ上で銘柄や時間足を選択すると、チャートが動的に切り替わる。  
  * **バックテストと完全同期したチャート**: strategy.ymlのデータソース設定（直接読み込み/リサンプリング）をチャート表示にも反映させ、バックテストと完全に同じデータで視覚分析を行える。  
  * **パラメータ調整**: 各種テクニカル指標のパラメータをWebフォームからリアルタイムに変更し、チャートに即時反映させることができる。  
  * **チャートと取引履歴の連動**: 取引履歴テーブルの行をクリックすると、チャート上の該当期間がハイライトされ、視覚的な分析を支援する。  
* **設定の外部化**: 戦略ロジック、UIのデフォルトパラメータ、メール設定をYAMLファイルで管理し、保守性を確保する。

### **1.3. システム要件**

#### **1.3.1. 機能要件**

| 機能分類 | 機能概要 |
| :---- | :---- |
| **データ処理** | strategy.ymlのtimeframesセクション定義に基づき、各時間足の株価データを動的に読み込む。 \- source\_type: directの場合: file\_patternで指定された個別CSVファイルを読み込む。 \- source\_type: resampleの場合: ベースとなる短期足データを読み込み、Backtraderの機能でリサンプリングする。 |
| バックテスト実行 | run\_backtrader.pyを実行し、strategy.ymlに定義された戦略ロジックに基づき全銘柄のバックテストを行い、結果をCSVレポートとして出力する。 |
| Webアプリケーション | app.pyを実行することでFlaskサーバーを起動し、Webブラウザ上でチャート分析機能を提供する。 |
| インタラクティブチャート | ・銘柄、時間足、インジケーターのパラメータをWebUIから動的に変更可能。 ・チャートはマウス操作で拡大・縮小・移動が可能。 ・マウスホバーで日時、四本値、各インジケーターの値をツールチップで表示。 ・取引履歴テーブルとチャートが連動し、クリックでハイライト表示。 |
| 結果出力 | バックテスト実行時に、backtest\_results/reportディレクトリにサマリー、銘柄別詳細、統合取引履歴のCSVレポートを生成する。 |
| 通知・ログ機能 | システムの動作状況やエラーをログファイルに出力する。 |

#### **1.3.2. 非機能要件**

| 要件項目 | 内容 |
| :---- | :---- |
| 操作性 | 利用者はrun\_backtrader.pyでバックテストを行い、app.pyで分析用Webサーバーを起動する。実際の分析はWebブラウザのGUIで行う。 |
| 拡張性 | 取引戦略の全ロジック（データソース、エントリー、イグジット、サイジング）をstrategy.ymlで管理。インジケーターのリアルタイムな調整はWeb UIから可能。 |
| 保守性 | システム設定、戦略ロジック定義、Webサーバー、チャート生成機能などをファイル分割し、可読性とメンテナンス性を高める。 |
| 信頼性 | BacktraderとPlotlyという、実績のあるライブラリを基盤とすることで、計算と描画の信頼性を確保する。 |

### **1.4. システム構成**

#### **1.4.1. アーキテクチャ図（v74.5）**

 \[ strategy.yml \] \<------------------------------------------------+  
 (データソース定義, 戦略ロジック)                                      |  
       |                                                            |  
       \+----------------------------+-------------------------------+  
       |                            |                               |  
\[ CSV データ \]                   \[ run\_backtrader.py \]           \[ chart\_generator.py \]  
(5m, 60m, Day...)                (バックテスト実行)                  (チャートデータ生成)  
       |                            |                               |  
       \+-----\>\[ btrader\_strategy.py \]\<-------------------------------+  
                    (戦略解釈エンジン)  
                           |  
                           \+-----\>\[ CSVレポート \]  
                           |  
                           \+-----\>\[ ログファイル \]  
                                     ^  
                                     |  
\[ app.py (Flask) \]\<------------------+-------------------\>\[ Webブラウザ \]  
 (Webサーバー)                                                (UI/分析)

### **1.5. 運用フロー**

1. **データ準備**: dataディレクトリに分析したい銘柄のCSVデータ（例: 1332\_5m\_...csv, 1332\_60m\_...csv, 1332\_D\_...csv）を配置する。  
2. **戦略の定義**: strategy.ymlファイルを編集し、**使用するデータソース（timeframes）**、エントリー、イグジット、サイジングのルールを記述する。  
3. **バックテスト実行**: コマンドプロンプトで python run\_backtrader.py を実行する。  
4. **分析サーバー起動**: コマンドプロンプトで python app.py を実行する。  
5. **ブラウザで分析**: Webブラウザで http://127.0.0.1:5001 を開き、以下の操作を行う。  
   * ドロップダウンで銘柄と時間足を切り替え。  
   * 入力フォームでインジケーターのパラメータをリアルタイムに変更。  
   * 取引履歴テーブルをクリックして、チャート上の取引をハイライト。  
6. **結果確認**: backtest\_results/report内のCSVレポートで、数値的なパフォーマンスを確認する。  
7. **分析と改善**: 分析結果を基に、strategy.ymlの戦略定義を改善し、再度バックテストを実行する。

### **1.6. リスクと対策**

| リスク | 対策 |
| :---- | :---- |
| 戦略ロジックのバグ | trade\_historyレポートで、意図した通りの「エントリー根拠」で取引が行われているかを確認する。ログファイルで取引前後の資金変動やインジケーターの値を追う。 |
| 過学習（カーブフィッティング） | 同じデータセットでパラメータ調整を繰り返すと、そのデータにのみ過度に最適化されてしまう。定期的に新しい期間のデータでテストを行い、戦略の堅牢性を確認する。 |
| CSVデータのフォーマットエラー | システムが想定するカラム名（datetime, open, high, low, close, volume）と日付形式 (YYYY-MM-DD HH:MM:SS) にデータが従っていることを確認する。 |
| **データ不整合** | **strategy.ymlでdirect指定時にfile\_patternが間違っていると、該当ファイルが見つからずエラーとなる。ログを確認し、ファイル名とパターンが一致しているか確認する。** |

### **1.7. 免責事項**

本システムは、特定の投資成果を保証するものではない。本システムを利用した結果生じたいかなる金融上の損失についても、開発者は一切の責任を負わないものとする。投資に関する最終的な決定は、利用者自身の判断と責任において行うこと。

## **2\. 株自動トレードシステム 詳細設計書 (v74.5)**

### **2.1. アーキテクチャ**

システムは、以下の3つの主要コンポーネントで構成される。

1. **バックテストエンジン (run\_backtrader.py, btrader\_strategy.py)**: strategy.ymlに定義された**データソースと戦略ルール**を動的に解釈してバックテストを実行し、結果をCSVレポートに出力する。  
2. **Webアプリケーションサーバー (app.py)**: Flaskをベースとし、ブラウザからのリクエストに応じてチャート生成モジュールを呼び出し、結果を動的に表示するWebページを提供する。  
3. **チャート生成モジュール (chart\_generator.py)**: app.pyからライブラリとして呼び出され、**strategy.ymlのデータソース定義を解釈**し、適切な価格データとインジケーターパラメータに基づき、PlotlyのグラフオブジェクトをJSON形式で生成する。

### **2.2. 環境構築と使用方法**

1. **プロジェクトファイルの配置**: create\_project\_files.pyを実行し、全ファイルを単一のディレクトリに生成する。  
2. **仮想環境の構築 (推奨)**:  
   python \-m venv venv  
   .\\venv\\Scripts\\activate  \# Windowsの場合  
   \# source venv/bin/activate  \# macOS/Linuxの場合

3. **ライブラリのインストール**:  
   pip install \-r requirements.txt

4. **バックテストの実行**:  
   python run\_backtrader.py

5. **Web分析ツールの起動**:  
   python app.py

6. **ブラウザでアクセス**: Webブラウザで http://127.0.0.1:5001 を開く。

### **2.3. モジュール別詳細仕様**

#### **2.3.1. requirements.txt**

* **役割**: プロジェクトの実行に必要なPythonライブラリとそのバージョンを定義する。  
* **内容**: backtrader, pandas, numpy, PyYAML, matplotlib, plotly, Flask

#### **2.3.2. config\_backtrader.py**

* **役割**: システム全体で共有される静的な設定値を管理する。  
* **内容**: ディレクトリパス、初期資金、手数料率、スリッページ率、ログレベル等を定義。

#### **2.3.3. strategy.yml**

* **役割**: 取引戦略の**ロジック、パラメータ、そして使用するデータソース**を人間が編集しやすい形式で一元管理する。  
* **主要なセクション**:  
  * trading\_mode: ロング/ショート戦略の有効/無効を切り替える。  
  * timeframes: **\[v74新機能\]** 長期・中期・短期の各時間足について、**データソース (source\_type)**、ファイル名パターン (file\_pattern)、Backtrader用の時間枠 (timeframe, compression) を定義する。  
  * entry\_conditions: エントリー戦略のコアロジックを定義する。  
  * exit\_conditions: ATRに基づいた損切り・利確ルールを定義する。  
  * sizing: 1トレードあたりのリスク許容度に基づいたポジションサイズ計算ルールを定義する。  
  * indicators: Web UIで表示する各テクニカル指標の**表示上のデフォルト値**を定義する。

#### **2.3.4. btrader\_strategy.py**

* **役割**: strategy.ymlを動的に解釈する汎用的な戦略実行エンジン。  
* **主要なメソッド**:  
  * \_\_init\_\_: strategy.ymlの定義に基づき、戦略で使用する全インジケーターを事前に一度だけインスタンス化し、辞書に保持する。  
  * \_evaluate\_condition: YAMLに定義された単一の条件（例: ema \> closeやema1 crossover ema2）を評価するヘルパー関数。  
  * next: ポジションがない場合にエントリー条件を評価し、条件が満たされた場合、サイジングと決済条件に基づき注文を発注する。  
  * notify\_order: 注文状態を監視し、ログを出力する。エントリー約定後には決済注文（OCO）を発注する。  
  * notify\_trade: トレードの開始・終了を記録し、後の分析で利用できるようカスタム情報をtradeオブジェクトに付与する。

#### **2.3.5. run\_backtrader.py**

* **役割**: バックテスト全体の実行を管理し、レポートファイル（CSV）を出力する。  
* **主要な内容**:  
  * TradeList(bt.Analyzer): 取引履歴を詳細に記録するためのカスタムアナライザー。  
  * load\_data\_feed: 単一のCSVファイルを読み込み、bt.feeds.PandasDataオブジェクトを生成する。  
  * run\_backtest\_for\_symbol: **\[v74改修箇所\]**  
    1. strategy.ymlのtimeframesセクションを読み込む。  
    2. source\_typeに応じてdirect読み込みかresampleかを判断し、Cerebroにデータフィードを追加する。  
    3. cerebro.run()でバックテストを実行する。  
  * main: dataディレクトリ内のベースデータファイルに対してループ処理を行い、全銘柄のバックテストを実行。結果を集計し、レポートを保存する。

#### **2.3.6. chart\_generator.py**

* **役割**: app.pyから呼び出されるライブラリとして、strategy.ymlの設定と同期したPlotlyのグラフオブジェクトを生成する。**v74.5では、以前のバージョンで一部欠落していたSMA、ボリンジャーバンド、MACD、RSI等の主要インジケーターの計算と描画ロジックが完全に復元され、表示の信頼性が大幅に向上した。**  
* **主要な関数**:  
  * price\_data\_cache: **\[v74改修箇所\]** 銘柄ごと、さらに時間足ごとにDataFrameを保持するネストした辞書構造。  
  * load\_data: **\[v74改修箇所\]** アプリ起動時に、strategy.ymlのsource\_type: directで指定されたファイルと、必須の短期ベースデータを読み込みキャッシュする。  
  * generate\_chart\_json: **\[v74改修箇所\]**  
    1. リクエストされた時間足のsource\_typeを確認。  
    2. directの場合はキャッシュからデータを取得。  
    3. resampleの場合はキャッシュの短期データをその場でリサンプリング。  
    4. 取得・生成したDataFrameを基に、**UIから指定された全パラメータを用いてSMA、ボリンジャーバンド、一目均衡表、MACD、RSI等の**インジケーター計算とチャート描画を行う。

#### **2.3.7. app.py**

* **役割**: Flaskサーバーを起動し、フロントエンドとバックエンドの橋渡しを行う。  
* **主要なエンドポイント**:  
  * @app.route('/'): メインページ (index.html) を描画する。  
  * @app.route('/get\_chart\_data'): ブラウザからの非同期リクエストを受け付け、chart\_generatorを呼び出してチャートと取引履歴のJSONデータを返すAPI。

#### **2.3.8. templates/index.html**

* **役割**: ユーザーインターフェースの構造を定義し、チャートの動的更新ロジックを実装する。  
* **主要なコンポーネント**: コントロールパネル、チャート表示領域、取引履歴テーブル。**コントロールパネルには、SMA、ボリンジャーバンド、一目均衡表など、多数のインジケーターパラメータを調整するための入力フォームが含まれる。**  
* **JavaScriptロジック**: コントロールパネルの変更を検知し、updateChart()関数でAPIにリクエストを送信。返されたJSONでPlotlyチャートとテーブルを更新する。

## **3\. チャート機能 詳細設計書 (v74.5)**

### **3.1. 機能の目的とアーキテクチャ**

#### **3.1.1. 機能の目的**

本機能は、バックテスト結果を視覚化し、戦略の挙動を直感的に分析するためのインタラクティブなチャートをWebブラウザ上に提供することを目的とする。**strategy.ymlで定義されたデータソース（直接読み込み/リサンプリング）と完全に一致したデータ**をチャートに表示することで、分析の信頼性を保証する。

#### **3.1.2. アーキテクチャ**

* **データフロー**:  
  1. ブラウザがUIのフォームを変更する。  
  2. JavaScriptが/get\_chart\_data APIにリクエストを送信する。  
  3. app.pyがリクエストを受け取り、chart\_generator.pyを呼び出す。  
  4. chart\_generator.pyがstrategy.ymlの設定を確認し、**適切なデータソース（キャッシュされた個別ファイル or 短期データからのリサンプリング）を選択**してチャートデータを生成する。  
  5. 生成されたJSONがブラウザに返され、チャートが更新される。

### **3.2. インターフェース仕様**

#### **3.2.1. 入力 (バックエンド)**

* strategy.yml: 各種インジケーターのデフォルトパラメータ、**および各時間足のデータソース定義**。  
* data/\*.csv: **strategy.ymlで指定されたすべての**価格データファイル。  
* backtest\_results/report/trade\_history\_\*.csv: バックテストによる取引履歴。

### **3.3. 機能仕様詳細**

#### **3.3.1. 基本チャート機能**

| 機能 | 仕様 |
| :---- | :---- |
| **データソースの同期** | \[v74新機能\] 表示されるチャートのデータ期間は、strategy.ymlで指定されたソースファイルの期間と完全に一致する。 \- 例：longをdirect指定し、日足ファイルが2000年から存在する場合、長期チャートは2000年からのデータを表示する。 \- 例：longをresample指定した場合、短期データの存在する期間（例: 2025年〜）でリサンプリングされた日足チャートが表示される。 |
| ローソク足 | 陽線は赤、陰線は緑で表示。 |
| 出来高 | ローソク足の色に連動した棒グラフとして、価格チャートの第2Y軸に半透明（opacity: 0.3）で描画。 |
| ズーム/パン | マウスホイールとドラッグでチャートの表示範囲を自由に変更可能。 |
| ツールチップ | hovermode: 'x unified'を使用し、マウスカーソル位置の全データをまとめて表示。 |
| 時間軸の最適化 | 短期・中期チャートでは、週末・夜間・昼休みを時間軸から除外。長期（日足）チャートでは週末のみを除外する。 |

#### **3.3.2. インジケーター・取引表示**

| 機能 | 仕様 |
| :---- | :---- |
| 移動平均線 (SMA/EMA) | 全時間足に対応。価格チャートに重ねて描画。期間はWebフォームから変更可能。 |
| ボリンジャーバンド | 全時間足に対応。価格チャートに重ねて描画。期間と標準偏差はWebフォームから変更可能。バンド間は半透明で塗りつぶされる。 |
| **VWAP (出来高加重平均価格)** | **Webフォームのチェックボックスで表示/非表示を切り替え可能。日毎にリセットされる。** |
| **一目均衡表** | **価格チャートに転換線、基準線、遅行スパン、先行スパンA/B（雲）を重ねて描画。パラメータはWebフォームから変更可能。** |
| MACD | サブプロットに描画。ヒストグラム、MACD線、シグナル線を表示。 |
| Stochastic | サブプロットに描画。%K線、%D線、および80/20の閾値ラインを表示。 |
| RSI | サブプロットに描画。RSI線と70/30の閾値ラインを表示。 |
| ADX/DMI | サブプロットにADX、+DI、-DIを線で描画。 |
| ATR | サブプロットにATRを線で描画。 |
| 売買ポイント | 取引があった箇所にマーカーを表示（BUY: 赤▲, SELL: 緑▼）。 |

## **4\. ATRトレーリングストップ 実装仕様書 (v74.5)**

### **4.1. 目的と実装方針**

利益を自動で追従（トレール）させながら損失を限定する、よりダイナミックな決済戦略を可能にするため、**ATRトレーリングストップ**機能が実装されている。この機能はv74.5においても、Backtraderの**ネイティブ機能**であるbt.Order.StopTrailとOCO（One-Cancels-Other）注文を活用して実現されており、信頼性とシンプルさを確保している。

### **4.2. strategy.yml 仕様**

exit\_conditions.stop\_lossセクションで設定する。

| キー | 説明 | 設定例 |
| :---- | :---- | :---- |
| type | atr\_stoptrail を指定する。(atr\_multipleで固定損切り) | atr\_stoptrail |
| timeframe | ATRの計算に使用する時間足を指定します。（short, medium, long） | short |
| params.period | ATRの期間。 | 14 |
| params.multiplier | ATRの倍率。trailamount（トレール幅）として使用される。 | 2.5 |

### **4.3. btrader\_strategy.py 実装仕様**

* **注文方式**: next()メソッドでの手動トレーリングロジックは実装されておらず、notify\_order()内で、エントリー約定後に決済注文を発注する方式を採用している。  
* **ネイティブOCO注文**: \_place\_exit\_orders()メソッド内で、利確注文（Limit）とトレーリングストップ注文（StopTrail）をoco引数で連携させ、どちらか一方が約定すればもう一方は自動的にキャンセルされる。  
* **トレーリング処理**: **完全にBacktraderエンジンに委任**されており、手動での価格追従ロジックは存在しない。

## **5\. トレード戦略のカスタマイズ方法 (v74.5)**

このシステムでは、トレードのロジックはすべてstrategy.ymlファイルで定義します。このファイルを編集することで、プログラミングの知識がなくても様々な戦略を試すことができます。

### **5.1. データソースの定義 (timeframes)**

**\[最重要\]** バックテストとチャート表示で使用するデータの元を定義するセクションです。

**設定例:**

timeframes:  
  long: \# 長期足の設定  
    source\_type: direct            \# 'direct' (直接) または 'resample' (リサンプリング)  
    timeframe: "Days"              \# Backtrader用の時間単位  
    compression: 1                 \# Backtrader用の圧縮率 (1日)  
    file\_pattern: "{symbol}\_D\_\*.csv" \# direct時に読み込むファイル名のパターン

  medium: \# 中期足の設定  
    source\_type: resample  
    timeframe: "Minutes"  
    compression: 60  
    \# file\_patternは不要

  short: \# 短期足の設定 (常に直接読み込み)  
    timeframe: "Minutes"  
    compression: 5  
    \# 短期足のファイルパターンはrun\_backtrader.pyが自動で解決

#### **5.1.1. 主要パラメータ解説**

* source\_type:  
  * direct: file\_patternで指定されたCSVファイルを個別に読み込みます。各時間足で独立したデータを使いたい場合に設定します。  
  * resample: 短期足のデータを基に、Backtraderが指定の時間足にリサンプリング（変換）します。  
* file\_pattern:  
  * source\_type: directの時に必須です。{symbol}は実行時に銘柄コードに置換されます。\*はワイルドカードとして使えます。

### **5.2. エントリー条件の定義 (entry\_conditions)**

エントリー条件は、long（買い）とshort（売り）のそれぞれについて、満たすべき条件をリスト形式で記述します。リスト内の条件はすべて満たされる必要（AND条件）があります。

**設定例:**

entry\_conditions:  
  long: \# ロングエントリー条件  
    \# 条件1: 長期足で20EMAより上  
    \- { timeframe: "long", indicator: { name: "ema", params: { period: 20 } }, compare: "\>", target: { type: "data", value: "close" } }  
    \# 条件2: 短期足でゴールデンクロス  
    \- { timeframe: "short", type: "crossover", indicator1: { name: "ema", params: { period: 10 } }, indicator2: { name: "ema", params: { period: 25 } } }

### **5.3. イグジット条件の定義 (exit\_conditions)**

ATRに基づいた損切りと利確のルールを定義します。

**設定例:**

exit\_conditions:  
  take\_profit:  
    type: "atr\_multiple"  
    timeframe: "short"  
    params: { period: 14, multiplier: 5.0 }  
  stop\_loss:  
    type: "atr\_stoptrail"  
    timeframe: "short"  
    params: { period: 14, multiplier: 2.5 }

### **5.4. ポジションサイジングの定義 (sizing)**

1トレードあたりのリスクに基づいて、ポジションサイズ（取引数量）を自動で計算します。

**設定例:**

sizing:  
  risk\_per\_trade: 0.01  
  max\_investment\_per\_trade: 10000000

## **6\. エントリー戦略アイデア集**

### **はじめに**

このドキュメントは、**長期(long)、中期(medium)、短期(short)の3つの時間軸をすべて利用**し、様々な市場の状況に対応するための30パターンのエントリー戦略アイデア集です。これらの設定例をベースに、パラメータを最適化してご自身の戦略を構築してください。

### **カテゴリー1: トレンドフォロー戦略 (Trend Following)**

**1\. SMA \+ RSI \+ EMAクロス (基本形)**

* **ロジック:** 長期SMAで上昇トレンドを確認し、中期RSIで押し目を測り、短期EMAのゴールデンクロスでエントリー。

entry\_conditions:  
  long:  
    \- { timeframe: "long", indicator: { name: "sma", params: { period: 75 } }, compare: "\<", target: { type: "data", value: "close" } }  
    \- { timeframe: "medium", indicator: { name: "rsi", params: { period: 14 } }, compare: "\<", target: { type: "values", value: \[50\] } }  
    \- { timeframe: "short", type: "crossover", indicator1: { name: "ema", params: { period: 10 } }, indicator2: { name: "ema", params: { period: 25 } } }

**(以下、他の29個の戦略アイデアが続く...)**