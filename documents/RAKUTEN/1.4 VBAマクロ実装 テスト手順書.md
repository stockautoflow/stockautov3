はい、承知いたしました。  
「1.4 VBAマクロ実装」を検証するためのテスト手順書を作成します。

---

## **VBAマクロ実装 テスト手順書**

### **1\. 目的**

trading\_hub.xlsmの注文シートに実装されたVBAマクロが、以下の項目について設計書通りに動作することを検証する。

* 特定のセル（E2）の変更をトリガーとして正しく起動すること。  
* シート上の入力値を読み取り、注文処理（ダミーまたは実注文）を実行すること。  
* 実行結果をシート上に正しく書き込むこと。  
* 処理の完了をPython側に通知できる状態になること。

### **2\. テスト環境・準備**

* **ハードウェア/ソフトウェア**:  
  * Windows PC  
  * Microsoft Excel  
  * マーケットスピード II (MS2)  
* **ファイル**:  
  * VBAマクロが実装済みのexternal/trading\_hub.xlsm  
* **実行前状態**:  
  * MS2を起動し、ログイン済みであること。  
  * external/trading\_hub.xlsmをExcelで開いていること。  
  * 注文シートが表示されていること。

### **3\. テストケース**

#### **ケース1：正常系テスト（ダミー処理）**

ダミーの注文処理が成功することを確認する。

| テストID | TC-01 |
| :---- | :---- |
| **テスト項目** | 正常なパラメータによる買い注文 |
| **操作手順** | 1\. B2セルに「9984」と入力する。\<br\>2. B3セルに「BUY」と入力する。\<br\>3. B4セルに「100」と入力する。\<br\>4. B5セルに「MARKET」と入力する。\<br\>5. E2セル（実行ID）の値を「1」に変更してEnterキーを押す。 |
| **期待される結果** | 1\. C2セル（処理ステータス）に「**成功**」と表示される。 2\. C3セル（注文ID）に「ORDER\_...」といった形式のダミーIDが表示される。\<br\>3. C4セル（メッセージ）が空欄である。\<br\>4. E3セル（完了ID）の値が、E2セルと同じ「**1**」になる。 |

#### **ケース2：異常系テスト（ダミー処理）**

無効なパラメータでマクロがエラー処理を行うことを確認する。

| テストID | TC-02 |
| :---- | :---- |
| **テスト項目** | 無効なパラメータによる注文 |
| **操作手順** | 1\. B2セルに「ABC」（数値以外）と入力する。\<br\>2. B4セルに「100」と入力する。\<br\>3. E2セル（実行ID）の値を「2」に変更してEnterキーを押す。 |
| **期待される結果** | 1\. C2セル（処理ステータス）に「**エラー**」と表示される。 2\. C4セル（メッセージ）に「**無効なパラメータです。**」と表示される。 3\. C3セル（注文ID）が空欄である。\<br\>4. E3セル（完了ID）の値が、E2セルと同じ「**2**」になる。 |

#### **ケース3：正常系テスト（実注文）**

実際のMS2注文関数が呼び出されることを確認する。

| テストID | TC-03 |
| :---- | :---- |
| **前提条件** | VBAエディタ(Alt+F11)を開き、注文シートのコード内の**ダミー処理部分をコメントアウト**し、result \= MarketSpeed2.System.NewOrder(...)の行を有効化しておく。 |
| **テスト項目** | 実際のマーケットへの成行買い注文 |
| **操作手順** | 1\. B2セルに、実際に存在する銘柄コード（例: 7203）を入力する。\<br\>2. B3セルに「BUY」と入力する。\<br\>3. B4セルに、発注可能な最小単元（例: 100）を入力する。\<br\>4. B5セルに「MARKET」と入力する。\<br\>5. E2セル（実行ID）の値を「3」に変更してEnterキーを押す。 |
| **期待される結果** | 1\. C2セルに「**成功**」と表示される。 2\. C3セルに、MS2が発行した**実際の注文ID**が表示される。 3\. E3セルの値が、E2セルと同じ「**3**」になる。 4\. **【最重要】マーケットスピード II の「注文約定」画面で、今発注した注文が「受付中」として表示されていることを確認する。** |

#### **ケース4：トリガー外テスト**

監視対象外のセルを変更してもマクロが起動しないことを確認する。

| テストID | TC-04 |
| :---- | :---- |
| **テスト項目** | 監視対象外のセル変更 |
| **操作手順** | 1\. A1セルなど、E2以外の任意のセルを選択し、値を変更してEnterキーを押す。 |
| **期待される結果** | 1\. **何も起こらない。** 2\. C2, C3, C4, E3セルの値は一切変更されない。 |

