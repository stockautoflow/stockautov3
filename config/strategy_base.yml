# v2.0 - Sizing改修版
# 変更点:
#   - 'sizing.method' を 'backtest_method' と 'realtrade_method' に分割。
#   - ケリー基準用の 'kelly_criterion' ブロックを追加。

strategy_name: "Dynamic Timeframe Strategy"
trading_mode:
  long_enabled: True
  short_enabled: True

# === ▼▼▼ データ読み込み設定 ▼▼▼ ===
# source_type: 'resample' または 'direct' を指定
#   resample: shortのデータからリサンプリングして生成 (デフォルト)
#   direct: file_patternで指定されたファイルを直接読み込む
# timeframe / compression: Backtraderがデータを解釈するために必要
# file_pattern: direct指定時に読み込むファイル名。{symbol}が銘柄コードに置換される。
timeframes:
  long:
    source_type: direct
    timeframe: "Days"
    compression: 1
    file_pattern: "{symbol}_D_*.csv"
  medium:
    source_type: direct
    timeframe: "Minutes"
    compression: 60
    file_pattern: "{symbol}_60m_*.csv"
  short:
    # 短期データは常に直接読み込み。source_typeは不要。
    timeframe: "Minutes"
    compression: 5

# === ▲▲▲ データ読み込み設定ここまで ▲▲▲ ===

entry_conditions:
  long:
    - { timeframe: "long", indicator: { name: "ema", params: { period: 20 } }, compare: ">", target: { type: "data", value: "close" } }
    - { timeframe: "medium", indicator: { name: "rsi", params: { period: 14 } }, compare: "<", target: { type: "values", value: [40] } }
    - { timeframe: "short", type: "crossover", indicator1: { name: "ema", params: { period: 10 } }, indicator2: { name: "ema", params: { period: 25 } } }
  short:
   - { timeframe: "long", indicator: { name: "ema", params: { period: 20 } }, compare: "<", target: { type: "data", value: "close" } }
   - { timeframe: "medium", indicator: { name: "rsi", params: { period: 14 } }, compare: ">", target: { type: "values", value: [60] } }
   - { timeframe: "short", type: "crossunder", indicator1: { name: "ema", params: { period: 10 } }, indicator2: { name: "ema", params: { period: 25 } } }

exit_conditions:
  take_profit:
    type: "atr_multiple"
    timeframe: "short"
    params: { period: 14, multiplier: 5.0 }
  stop_loss:
    type: "atr_stoptrail"
    timeframe: "short"
    params: { period: 14, multiplier: 2.5 }

# === ▼▼▼ ここから v2.0 置き換え ▼▼▼ ===
sizing:
  # === 方式選択 ===
  # 'risk_based' (リスクベース方式)
  # 'kelly_criterion' (ケリー基準方式)
  backtest_method: 'risk_based'
  # backtest_method: 'kelly_criterion'
  # realtrade_method: 'risk_based'
  realtrade_method: 'kelly_criterion'

  # === (A) リスクベース方式の設定 (現状) ===
  risk_based:
    risk_per_trade: 0.01 # 1トレードあたりのリスク(資金に対する割合)

  # === (B) ケリー基準方式の設定 (新規) ===
  kelly_criterion:
    # f値（投資比率）のソースを指定
    # 'adjusted': 評価(evaluation)で算出した調整済みf値 (Kelly_Adj) を使用 (推奨)
    # 'raw': 評価(evaluation)で算出した生f値 (Kelly_Raw) を使用
    # 'fixed': 下記の 'fixed_f_value' を使用 (バックテスト時や固定比率投資用)
    f_value_source: 'adjusted' 
    
    # 'fixed' を選んだ場合の固定f値 (例: 0.1 = 常に資金の10%)
    fixed_f_value: 0.1 

    # f値の上限 (Fractional Kelly)。過大なベットを防ぐ安全装置
    # (例: 0.25 = 算出したf値がこれを超えても、最大25%までしか投資しない)
    max_f_value_cap: 0.25 

  # === (C) 共通の制約 ===
  # どちらの方式でも適用される1トレードあたりの最大投資額(円)
  max_investment_per_trade: 10000000 
# === ▲▲▲ ここまで v2.0 置き換え ▲▲▲ ===

indicators:
  long_ema_period: 200
  medium_rsi_period: 14
  short_ema_fast: 10
  short_ema_slow: 25
  atr_period: 14
  adx: { period: 14 }
  macd: { fast_period: 12, slow_period: 26, signal_period: 9 }
  stochastic: { period: 14, period_dfast: 3, period_dslow: 3 }
  bollinger: { period: 20, devfactor: 2.0 }
  sma: { fast_period: 5, slow_period: 20 }
  vwap: { enabled: True }
  ichimoku: { tenkan_period: 9, kijun_period: 26, senkou_span_b_period: 52, chikou_period: 26 }