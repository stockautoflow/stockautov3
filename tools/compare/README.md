# ファイル比較ツール (Advanced File Comparison Tool)

## 概要

この Python スクリプトは、2つのディレクトリ間に存在するファイルを、柔軟なルールに基づいて比較するためのツールです。単なるファイル比較だけでなく、命名規則に基づいた最新の結果フォルダや最新のファイルを自動で特定し、比較対象とすることができます。

比較結果は、コンソール上で絵文字や色を使って視覚的に分かりやすく表示され、実行後にはサマリーレポートで全体像を素早く把握できます。

## 主な機能 ✨

  * **柔軟な比較設定**: `compare_list.yml` ファイルで、複数の比較元・比較先ディレクトリのペアを自由に設定できます。
  * **最新フォルダの自動検出**: 比較対象フォルダ内にタイムスタンプ付きのサブフォルダが複数ある場合、作成日時が最も新しいフォルダを自動で比較対象にします。
  * **最新ファイルの自動選択**: 比較パターンに一致するファイルが複数見つかった場合、最終更新日時が最も新しいファイルを選択します。
  * **視覚的な結果表示**:
      * 比較結果（一致、不一致、スキップ等）を絵文字（✅ ❌ ⏭️）で直感的に表示します。
      * 差分があった場合、コンソールに追加行を\<font color="green"\>緑\</font\>、削除行を\<font color="red"\>赤\</font\>でハイライト表示します。
  * **サマリーレポート**: 全ての比較処理完了後、結果の内訳（一致、不一致、スキTップ件数など）をまとめたレポートを表示します。
  * **詳細なログファイル**: 実行日時を含むログファイル（例: `log/compare_20250724_094133.log`）を自動で生成し、すべての処理の詳細を記録します。

-----

## 必要なもの

  * Python 3.6 以上
  * PyYAML ライブラリ
    ```sh
    pip install pyyaml
    ```

-----

## 使い方

### 1\. `compare_list.yml` の設定

スクリプトと同じ階層に `compare_list.yml` ファイルを作成し、比較したいディレクトリのペアを記述します。

#### 基本的な設定

比較したい `source` (比較元) と `target` (比較先) のディレクトリパスを指定します。

```yaml
- source: C:\path\to\source_directory_A
  target: C:\path\to\target_directory_A

- source: C:\path\to\source_directory_B
  target: C:\path\to\target_directory_B
```

#### 高度な設定（最新サブフォルダの自動検索）

比較先の `target` ディレクトリ内で、**作成日時が最も新しいサブフォルダ**を自動的に検索して比較対象としたい場合は、`target` に親ディレクトリを指定し、`target_find_latest_subdir: true` を追加します。

この機能は、`source` という名前のフォルダを検索対象から自動的に除外します。

```yaml
# C:\stockautov3\results\evaluation\ 内にある最新のフォルダを比較対象にする例
- source: C:\stockautov3\results\evaluation\source\ok_173_2025-07-21-170130
  target: C:\stockautov3\results\evaluation\
  target_find_latest_subdir: true
```

### 2\. スクリプトの実行

設定ファイルを作成したら、ターミナルまたはコマンドプロンプトで以下のコマンドを実行します。

```sh
python compare.py
```

### 3\. 出力結果の確認

実行すると、コンソールにリアルタイムで整形された結果が表示されます。

#### 出力例

```
▶ 比較セット開始: ok_173_2025-07-21-170130 <-> evaluation
  ℹ️ [INFO] 'C:\stockautov3\results\evaluation' 内で最新のサブディレクトリを検索します...
  ℹ️ [INFO]  -> 最新の比較先フォルダとして '2025-07-24-093000' を使用します。
    ✅ [OK] summary_....csv  <->  summary_....csv
    ❌ [NG] detail_....csv  <->  detail_....csv
      ┌─── 差分詳細 ───────
      │ - old_line_content
      │ + new_line_content
      └────────────────────
    ⏭️  [SKIP] パターン 'trade_history_*' のファイルが片方にしか存在しません。

==================================================
📋 比較結果サマリー
==================================================
  ✅ 一致 (OK)    :    1 件
  ❌ 不一致 (NG)  :    1 件
  ⏭️ スキップ     :    1 件
  ⚠️ 警告 (WARN)  :    0 件
  🛑 エラー       :    0 件
--------------------------------------------------
  合計           :    3 件
==================================================
```
